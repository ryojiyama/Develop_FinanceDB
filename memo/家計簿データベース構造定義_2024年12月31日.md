# 家計簿データベース構造定義

## 1. 口座マスター (accounts)

口座情報を管理するマスターテーブル

### テーブル定義
| カラム名 | データ型 | NULL | 説明 |
|----------|----------|------|------|
| id | SERIAL | NOT NULL | 主キー |
| account_name | VARCHAR(50) | NOT NULL | 口座名称 |
| account_type | VARCHAR(20) | NOT NULL | 口座種別（銀行/クレジットカード） |
| is_active | BOOLEAN | NOT NULL | アクティブフラグ（デフォルト：true） |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |

### 登録済データ
| id | account_name | account_type | is_active |
|----|--------------|--------------|-----------|
| 1 | 三井住友銀行_亮司 | 銀行 | true |
| 2 | みなと銀行_淳子 | 銀行 | true |
| 3 | Amazonカード | クレジットカード | true |
| 4 | 三井住友カード | クレジットカード | true |
| 5 | 大丸カード | クレジットカード | true |

## 2. カテゴリマスター (categories)

取引カテゴリを管理するマスターテーブル

### テーブル定義
| カラム名 | データ型 | NULL | 説明 |
|----------|----------|------|------|
| id | SERIAL | NOT NULL | 主キー |
| category_name | VARCHAR(50) | NOT NULL | カテゴリ名称 |
| is_expense | BOOLEAN | NOT NULL | 支出フラグ（true: 支出, false: 収入） |
| display_order | INTEGER | NULL | 表示順 |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |

### 登録済カテゴリ一覧
#### 収入カテゴリ（is_expense = false）
1. 給与
2. 投資収益
3. 臨時収入
4. 年金

#### 支出カテゴリ（is_expense = true）
5. 食費
6. 衣服・美容
7. 教育・教養
8. 交通費
9. 日用品
10. 通信費
11. 趣味
12. 交際費
13. 自動車
14. 住宅ローン
15. 住宅共同
16. 保険
17. 健康・医療
18. 税・社会保障
19. 資産運用
20. 特別な支出
21. その他

## 3. 取引テーブル (transactions)

実際の取引データを記録するメインテーブル

### テーブル定義
| カラム名 | データ型 | NULL | 説明 |
|----------|----------|------|------|
| id | SERIAL | NOT NULL | 主キー |
| transaction_date | DATE | NOT NULL | 取引日 |
| description | TEXT | NOT NULL | 取引内容 |
| withdrawal | INTEGER | NULL | 引出額 |
| deposit | INTEGER | NULL | 預入額 |
| amount | INTEGER | NULL | 金額（カード取引用） |
| balance | INTEGER | NULL | 残高 |
| account_id | INTEGER | NULL | 口座ID（外部キー：accounts.id） |
| category_id | INTEGER | NULL | カテゴリID（外部キー：categories.id） |
| transaction_type | VARCHAR(20) | NULL | 取引種別 |
| is_regular | BOOLEAN | NULL | 定期取引フラグ |
| calculation_target | BOOLEAN | NOT NULL | 計算対象フラグ（デフォルト：true） |
| memo | TEXT | NULL | メモ |
| source_file | TEXT | NULL | データ元ファイル |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NULL | 更新日時 |

### 主要な制約
- 外部キー制約：
  - account_id → accounts(id)
  - category_id → categories(id)
- デフォルト値：
  - calculation_target: true
  - created_at: CURRENT_TIMESTAMP

### 補足説明
1. **金額関連フィールド**
   - withdrawal: 銀行口座からの引出額
   - deposit: 銀行口座への預入額
   - amount: クレジットカード利用額
   - balance: 取引後の口座残高

2. **取引種別の例**
   - 給与振込
   - 引き落とし
   - カード利用
   - ATM出金
   - 振込

3. **日付管理**
   - transaction_date: 実際の取引発生日
   - created_at: レコード作成日時
   - updated_at: レコード更新日時
